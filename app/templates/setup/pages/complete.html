{% extends "layouts/base.html" %}
{% block title %}{{ _("Restarting...") }}{% endblock %}

{% block base_content %}
{% if environment == "production" %}
  {% set command = "sudo systemctl restart devpush" %}
{% else %}
  {% set command = "./scripts/restart.sh" %}
{% endif %}
<div class="h-screen flex items-center justify-center">
  <div class="flex min-w-0 flex-1 flex-col items-center justify-center gap-6 rounded-lg border-dashed p-6 text-center text-balance md:p-12">
    <header class="flex max-w-sm flex-col items-center gap-2 text-center">
      <div class="mb-2 bg-green-100 dark:bg-green-950 text-green-600 dark:text-green-400 flex size-8 shrink-0 items-center justify-center rounded-full [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
        {% include "icons/check.svg" %}
      </div>
      <h3 class="text-lg font-semibold tracking-tight">{{ _("Setup complete") }}</h3>
      <p class="text-muted-foreground text-sm/relaxed [&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4">
        {{ _("The configuration has been saved.") }}
        {{ _("Restart the services with the command below, and visit the app at <a href='%(target_url)s' target='_blank'>%(app_hostname)s</a>.", target_url=target_url, app_hostname=app_hostname) | safe }}
      </p>
    </header>
    <section class="flex w-full min-w-0 flex-col items-center gap-3">
      <div class="relative max-w-75 w-full">
        <input type="text" class="input font-mono text-[13px] pr-9  w-full" value="{{ command }}" readonly>
        <button
          type="button"
          data-copied="false"
          onclick="
            const button = this;
            const input = button.previousElementSibling;
            if (!input) return;
            const value = input.value || '';
            const setCopied = () => {
              button.dataset.copied = 'true';
              setTimeout(() => button.dataset.copied = 'false', 1000);
            };
            if (navigator.clipboard && navigator.clipboard.writeText) {
              navigator.clipboard.writeText(value).then(setCopied);
            } else {
              const textarea = document.createElement('textarea');
              textarea.value = value;
              document.body.appendChild(textarea);
              textarea.select();
              document.execCommand('copy');
              document.body.removeChild(textarea);
              setCopied();
            }
          "
          class="group absolute right-1.5 top-1/2 -translate-y-1/2 btn-icon-ghost text-muted-foreground hover:text-accent-foreground size-6"
        >
          <span class="group-data-[copied=true]:hidden">
            {% include "icons/copy.svg" %}
          </span>
          <span class="hidden group-data-[copied=true]:block">
            {% include "icons/check.svg" %}
          </span>
        </button>
      </div>
    </section>
  </div>
</div>

{% endblock %}

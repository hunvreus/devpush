<form method="post"
  action="{{ url_for('project_settings', team_slug=team.slug, project_name=project.name).include_query_params(fragment='resources') }}"
  hx-post="{{ url_for('project_settings', team_slug=team.slug, project_name=project.name).include_query_params(fragment='resources') }}"
  hx-swap="outerHTML" x-data="{ changed: false }"
  hx-on::before-request="document.activeElement && document.activeElement.blur()"
  @input="changed = true"
  @change="changed = true"
  hx-indicator="next .htmx-indicator" class="card"
>
  {{ resources_form.csrf_token(id=False) }}
  <header class="border-b">
    <h2>{{ _('Resources') }}</h2>
    <p>{{ _('Configuration for the compute resources allocated to each deployment.') }}</p>
  </header>

  <section class="space-y-6">
    {{ resources_form.csrf_token(id=False) }}
    {% if allow_custom_cpu %}
      <div class="space-y-3">
        {{ resources_form.cpus.label() }}
        <div class="flex items-center gap-x-2" x-data="{ cpus: '{{ resources_form.cpus.data if resources_form.cpus.data is not none else '' }}' }">
          {{ resources_form.cpus(
            id=False,
            class="w-full",
            placeholder=(default_cpus if default_cpus is not none else _('Unlimited')),
            **{'x-model': 'cpus'}
          ) }}
          <button
            type="button"
            class="btn-icon-ghost"
            data-tooltip="{{ _('Use default') }}"
            :disabled="cpus == ''"
            @click="cpus = ''; $dispatch('change')"
          >
            {% include "icons/x.svg" %}
          </button>
        </div>
        <p class="text-sm text-muted-foreground">
          {% if max_cpus is not none %}
            {{ _('Number of CPU cores to allocate. Empty: use default. Max: %(max)s. Supports decimals like 0.5.', max=max_cpus) }}
          {% else %}
            {{ _('Number of CPU cores to allocate. Empty: use default. Supports decimals like 0.5.') }}
          {% endif %}
        </p>
        {% for error in resources_form.cpus.errors %}
          <p class="text-destructive text-sm">{{ error }}</p>
        {% endfor %}
      </div>
    {% endif %}
    {% if allow_custom_memory %}
      <div class="space-y-3">
        {{ resources_form.memory.label() }}
        <div class="flex items-center gap-x-2" x-data="{ memory: '{{ resources_form.memory.data if resources_form.memory.data is not none else '' }}' }">
          {{ resources_form.memory(
            id=False,
            class="w-full",
            placeholder=(default_memory if default_memory is not none else _('Unlimited')),
            **{'x-model': 'memory'}
          ) }}
          <button
            type="button"
            class="btn-icon-ghost"
            data-tooltip="{{ _('Use default') }}"
            :disabled="memory == ''"
            @click="memory = ''; $dispatch('change')"
          >
            {% include "icons/x.svg" %}
          </button>
        </div>
        <p class="text-sm text-muted-foreground">
          {% if max_memory is not none %}
            {{ _('Memory limit in megabytes. Empty: use default. Max: %(max)s MB.', max=max_memory) }}
          {% else %}
            {{ _('Memory limit in megabytes. Empty: use default.') }}
          {% endif %}
        </p>
        {% for error in resources_form.memory.errors %}
          <p class="text-destructive text-sm">{{ error }}</p>
        {% endfor %}
      </div>
    {% endif %}
  </section>

  <footer class="flex justify-end gap-x-2">
    <button type="button" class="btn-sm-ghost"
      hx-get="{{ url_for('project_settings', team_slug=team.slug, project_name=project.name).include_query_params(fragment='resources') }}"
      hx-target="closest form" hx-swap="outerHTML" :disabled="!changed">{{ _('Cancel') }}</button>
    <button class="btn-sm" :disabled="!changed">{{ _('Save') }}</button>
  </footer>
</form>

<div class="htmx-indicator flex items-center justify-center inset-0 absolute bg-background/80 rounded-xl">
  <div class="flex items-center gap-x-2 text-muted-foreground [&>svg]:size-4 [&>svg]:animate-spin">
    {% include "icons/loader.svg" %}
    {{ _('Saving') }}
  </div>
</div>

{% extends "layouts/app.html" %}

{% block app_content %}
<div class="container max-w-screen-sm mx-auto p-8 space-y-6">
  <h1 class="h1 flex items-center gap-x-2.5">
    {{ _('New project') }}
  </h1>
  
  <ol class="flex items-center justify-between gap-x-2.5 mb-8">
    <li class="flex items-center gap-x-2.5 opacity-50">
      <div class="shrink-0 rounded-lg h-6 w-6 bg-primary text-primary-foreground flex items-center justify-center text-xs font-mono font-semibold">1</div>
      <h2 class="font-semibold">{{ _('Select repository') }}</h2>
    </li>
    <li class="flex-1">
      <hr class="h-px border-border"/>
    </li>
    <li class="flex items-center gap-x-2.5">
      <div class="shrink-0 rounded-lg h-6 w-6 bg-primary text-primary-foreground flex items-center justify-center text-xs font-mono font-semibold">2</div>
      <h2 class="font-semibold">{{ _('Configure') }}</h2>
    </li>
    <li class="flex-1">
      <hr class="h-px border-border"/>
    </li>
    <li class="flex items-center gap-x-2.5 opacity-50">
      <div class="shrink-0 rounded-lg h-6 w-6 bg-primary text-primary-foreground flex items-center justify-center text-xs font-mono font-semibold">3</div>
      <h2 class="font-semibold">{{ _('Deploy') }}</h2>
    </li>
  </ol>

  <form
    action=""
    method="post"
    class="form flex flex-col gap-y-6"
  >
    {{ form.hidden_tag() }}
    {{ form.repo_id(class_="hidden") }}
    <div class="space-y-6">
      <div class="field">
        <div class="flex gap-x-2">
          <div class="field flex-1">
            <label>{{ _('Repository') }}</label>
            <div class="relative">
              <input class="w-full !px-9" type="text" name="repo_full_name" value="{{ repo.full_name }}" disabled>
              <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 opacity-50">
                {% include "icons/github.svg" %}
              </span>
            </div>
          </div>
          <div class="field w-1/3">
            <label for="production_branch">{{ _('Production branch') }}</label>
            <div class="relative">
              {{ form.production_branch(class_="!pl-9 w-full") }}
              <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 opacity-50">
                {% include "icons/git-branch.svg" %}
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="field">
        {{ form.name.label() }}
        {{ form.name(
            size=100,
            class="w-full",
            required=True,
            placeholder="e.g. my-project",
            **({'aria-invalid': 'true'} if form.name.errors else {})
        ) }}
        {% for error in form.name.errors %}
        <p class="text-danger text-xs font-medium">{{ error }}</p>
        {% endfor %}
      </div>

      <details open>
        <summary>{{ _('Build & Deploy') }}</summary>
        {% from "projects/components/forms/build_and_deploy.html" import render_build_and_deploy %}
        {{ render_build_and_deploy(form) }}
      </details>

      <details
        {% if form.env_vars.errors or form.env_vars.data %}
          open
        {% endif %}
      >
        <summary >{{ _('Environment variables') }}</summary>
        {% from "projects/components/forms/env_vars.html" import render_env_vars %}
        {{ render_env_vars(form) }}
      </details>
    </div>

    <footer class="flex gap-x-2">
      <a href="{{ url_for('main.new_project') }}" class="btn-ghost w-full flex items-center gap-x-2">
        {% include "icons/arrow-left.svg" %}
        {{ _('Back') }}
      </a>
      {{ form.submit(class="btn btn-primary w-full", value="Create project") }}
    </footer>
  </form>
</div>
{% endblock %}
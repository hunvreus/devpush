{% extends "layouts/app.html" %}

{% block app_content %}
<div class="container max-w-screen-md mx-auto p-8 space-y-6">
  <h1 class="h1 flex items-center gap-x-2.5">
    {{ _('New project') }}
  </h1>

  <ol class="flex items-center justify-between gap-x-2.5 mb-8">
    <li class="flex items-center gap-x-2.5 opacity-50">
      <div
        class="shrink-0 rounded-full size-6 bg-primary text-primary-foreground flex items-center justify-center text-xs font-mono font-semibold">
        1</div>
      <h2 class="font-semibold">{{ _('Select repository') }}</h2>
    </li>
    <li class="flex-1">
      <hr class="h-px border-border" />
    </li>
    <li class="flex items-center gap-x-2.5">
      <div
        class="shrink-0 rounded-full size-6 bg-primary text-primary-foreground flex items-center justify-center text-xs font-mono font-semibold">
        2</div>
      <h2 class="font-semibold">{{ _('Configure') }}</h2>
    </li>
    <li class="flex-1">
      <hr class="h-px border-border" />
    </li>
    <li class="flex items-center gap-x-2.5 opacity-50">
      <div
        class="shrink-0 rounded-full size-6 bg-primary text-primary-foreground flex items-center justify-center text-xs font-mono font-semibold">
        3</div>
      <h2 class="font-semibold">{{ _('Deploy') }}</h2>
    </li>
  </ol>

  <form action="" method="post" class="form flex flex-col gap-y-6">
    {{ form.csrf_token() }}
    {{ form.repo_id(class_="hidden") }}
    <div class="space-y-6">
      <div class="flex gap-x-2">
        <div class="flex-1 space-y-3">
          <label>{{ _('Repository') }}</label>
          <div class="relative">
            <input class="w-full !px-9" type="text" name="repo_full_name" value="{{ repo_full_name }}" disabled>
            <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 opacity-50 [&>svg]:size-4">
              {% include "icons/github.svg" %}
            </span>
          </div>
        </div>
        <div class="w-1/3 space-y-3">
          <label for="production_branch">{{ _('Production branch') }}</label>
          <div class="relative">
            {{ form.production_branch(class_="!pl-9 w-full") }}
            <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 opacity-50 [&>svg]:size-4">
              {% include "icons/git-branch.svg" %}
            </span>
          </div>
        </div>
      </div>

      <div class="space-y-3">
        {{ form.name.label() }}
        {{ form.name(
        size=100,
        class="w-full",
        required=True,
        placeholder="e.g. my-project",
        **({'aria-invalid': 'true'} if form.name.errors else {})
        ) }}
        {% for error in form.name.errors %}
        <p class="text-destructive text-sm">{{ error }}</p>
        {% endfor %}
      </div>

      <details open class="w-full rounded-lg border group">
        <summary
          class="px-4 py-3 w-full flex items-center gap-x-2 group-open:[&>svg]:rotate-90 [&>svg]:transition-transform hover:bg-muted/50 rounded-lg transition-colors group-open:rounded-b-none [&>svg]:size-4">
          {% include "icons/chevron-right.svg" %}
          {{ _('Build & Deploy') }}
        </summary>
        <div class="p-4 border-t">
          {% from "projects/components/build_and_deploy.html" import render_build_and_deploy %}
          {{ render_build_and_deploy(form, frameworks) }}
        </div>
      </details>

      <details {% if form.env_vars.errors or form.env_vars.data %} open {% endif %}
        class="w-full rounded-lg border group">
        <summary
          class="px-4 py-3 w-full flex items-center gap-x-2 group-open:[&>svg]:rotate-90 [&>svg]:transition-transform hover:bg-muted/50 rounded-lg transition-colors group-open:rounded-b-none [&>svg]:size-4">
          {% include "icons/chevron-right.svg" %}
          {{ _('Environment variables') }}
        </summary>
        <div class="p-4 border-t">
          {% from "projects/components/env_vars.html" import render_env_vars %}
          {{ render_env_vars(form, environments) }}
        </div>
      </details>
    </div>

    <footer class="flex justify-between gap-x-2">
      <a href="{{ url_for('new_project', team_slug=team.slug) }}" class="btn-ghost flex-1">
        {% include "icons/arrow-left.svg" %}
        {{ _('Back') }}
      </a>
      {{ form.submit(class="btn flex-1", value="Create project") }}
    </footer>
  </form>
</div>
{% endblock %}
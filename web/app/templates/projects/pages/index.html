{% extends "layouts/app.html" %}

{% block app_content %}
<div class="container max-w-screen-xl mx-auto p-8 space-y-6">
  <h1 class="h1 flex items-center gap-x-3">
    {% from "projects/components/thumbnail.html" import thumbnail %}
    {{ thumbnail(project, size='md') }}
    {{ project.name }}
  </h1>

  <section class="space-y-4">
    <header class="flex justify-between items-center gap-x-4 h-8">
      <h2 class="h4">{{ _('Environments') }}</h2>
      <a
        href="{{ url_for('main.project_settings', project_name=project.name) }}#environments"
        class="btn-sm"
      >
        {% include "shared/icons/settings.svg" %}
        {{ _('Manage environments') }}
      </a>
    </header>

    <ul class="grid grid-cols-4 gap-4">
      {% for environment in project.active_environments %}
        <li class="bg-card text-card-foreground rounded-xl border shadow-sm p-4">
          <header class="flex items-center gap-x-2 mb-4 truncate">
            <a
              href="{{ url_for('main.project_deployments', project_name=project.name, environment=environment.slug) }}"
              class="flex items-center gap-x-2 mr-auto h-4 truncate"
            >
              <span class="w-4 h-4 flex items-center justify-center"><span class="inline-block rounded h-2.5 w-2.5 bg-{{ environment.color }}-400 dark:bg-{{ environment.color }}-600 shrink-0"></span></span>
              <span class=" flex-1 truncate font-medium">{{ environment.name }}</span>
            </a>
          </header>
          <ul class="space-y-1">
            <li>
              <a
                href="http://{{ project.slug }}-env-{{ environment.slug }}.{{ base_domain }}"
                class="text-muted-foreground flex items-center gap-x-2 hover:text-foreground transition-colors"
                target="_blank"
                data-tooltip="{{ _('Visit') }}"
              >
                <span class="opacity-50 dark:opacity-60 [&>svg]:size-4">
                  {% include "shared/icons/link-2.svg" %}
                </span>
                <span class="truncate">{{ project.slug }}-env-{{ environment.slug }}.{{ base_domain }}</span>
              </a>
            </li>
            <li>
              <span
                class="text-muted-foreground flex items-center gap-x-2 mr-auto"
                data-tooltip="{{ _('Branch') }}"
              >
                <span class="opacity-50 dark:opacity-60 [&>svg]:size-4">
                  {% include "shared/icons/git-branch.svg" %}
                </span>
                <span class="font-mono truncate">{{ environment.branch }}</span>
              </span>
            </li>
          </ul>
        </li>
      {% endfor %}
    </ul>
  </section>

  <section class="space-y-4">
    <header class="flex justify-between items-center gap-x-4 h-8">
      <h2 class="h4">{{ _('Latest deployments') }}</h2>
      {% if deployments %}
        {% include "projects/partials/_deploy-dialog.html" %}
        <button
          type="button"
          class="btn-sm"
          x-init
          @click="
            const dialog = document.getElementById('dialog-deploy');
            dialog.dispatchEvent(new Event('dialog:opened'));
            dialog.showModal();
          "
        >
          {% include "shared/icons/cloud-upload.svg" %}
          {{ _('Deploy') }}
        </button>
      {% endif %}
    </header>
    <div class="space-y-4">
      {% include "projects/partials/_index_sse.html" %}

      <div id="deployments">
        {% include "projects/partials/_index_deployments.html" %}
      </div>

      {% if deployments %}
        <footer class="flex justify-end">
          <a
            href="{{ url_for('main.project_deployments', project_name=project.name) }}"
            class="btn-sm-outline"
            aria-label="{{ _('All deployments') }}"
          >
            {{ _('All deployments') }}
            {% include "shared/icons/chevron-right.svg" %}
          </a>
        </footer>
      {% endif %}
    </div>
  </section>
</div>
{% endblock %}
<div hx-get="{{ url_for('project_settings', project_name=project.name).include_query_params(fragment='env_vars') }}"
  hx-trigger="environments:updated from:window" hx-swap="outerHTML" hx-indicator=".htmx-indicator">
  <form method="POST"
    action="{{ url_for('project_settings', project_name=project.name).include_query_params(fragment='env_vars') }}"
    hx-post="{{ url_for('project_settings', project_name=project.name).include_query_params(fragment='env_vars') }}"
    hx-indicator="next .htmx-indicator" hx-target="closest div" hx-swap="outerHTML" x-data="{ changed: false }"
    @input="changed = true" @change="changed = true" class="card">
    {{ env_vars_form.csrf_token() }}
    <header class="border-b">
      <h2>{{ _('Environment variables') }}</h2>
      <p>{{ _('Variables available at build time and runtime. Changes will take effect after a new deployment.') }}</p>
    </header>

    <section class=" space-y-6">
      {% from "projects/components/env_vars.html" import render_env_vars %}
      {{ render_env_vars(env_vars_form, project.active_environments) }}
    </section>

    <footer>
      <button class="btn" :disabled="!changed">{{ _('Save') }}</button>
    </footer>
  </form>

  <div class="htmx-indicator flex items-center justify-center inset-0 absolute bg-background/80 rounded-xl">
    <div class="flex items-center gap-x-2 text-muted-foreground [&>svg]:size-4 [&>svg]:animate-spin">
      {% include "icons/loader.svg" %}
      {{ _('Saving') }}
    </div>
  </div>
</div>
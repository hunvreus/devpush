{% from "components/dialog.html" import dialog %}
{% call dialog(
  title="Deploy",
  description="Select an environment to deploy to, and the commit you want to deploy.",
  id="dialog-deploy",
  dialog_attrs={"class": "w-full max-w-xl"},
  body_attrs={"class": "space-y-4"}
) %}
  <form
    method="GET"
    action="{{ url_for('project_deploy', project_name=project.name).include_query_params(fragment='environment') }}"
    hx-get="{{ url_for('project_deploy', project_name=project.name).include_query_params(fragment='environment') }}"
    hx-trigger="change, dialog:opened from:closest dialog"
    hx-indicator="next .htmx-indicator"
    hx-target="#deploy-dialog-form"
  >
  {% from "components/select.html" import select %}
  {% from "projects/components/environment-label.html" import environment_label %}
  {% call select(
    id='deploy-environment',
    name='environment_id'
  ) %}
    {% for environment in project.active_environments %}
      <div role="option" data-value="{{ environment['id'] }}">
        {{ environment_label(environment) }}
      </div>
    {% endfor %}
  {% endcall %}
  </form>
  <div class="relative block h-[292px]">
    <div id="deploy-dialog-form"></div>
    <div class="htmx-indicator absolute inset-0 space-y-4 bg-background">
      {% include "projects/partials/_deploy-dialog-commits-skeleton.html" %}
    </div>
  </div>
{% endcall %}